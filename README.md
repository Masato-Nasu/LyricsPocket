# LyricsPocket

端末にある **音源ファイル**（mp3 / m4a など）を再生しながら、**歌詞ファイル**（.lrc / .txt）を表示できる、完全クライアント側の軽量アプリ（PWA）です。  
歌詞中の英単語はワンタップで **TANGO-CHO** に渡して、単語帳／学習に回せます。

- **Demo**: https://masato-nasu.github.io/LyricsPocket/
- **対応**: PC（Chrome/Edge/Safari） / iPhone（Safari・PWA） / Android（Chrome・PWA）
- **重要**: 音源・歌詞は **配布しません**。ユーザーが所有／許諾を得たファイルを端末から選択して使う前提です。

![screenshot](screenshot1.png)

---

## できること / Features

- 🎵 **音源再生**：端末内の mp3 / m4a / aac / wav / flac / ogg 等を読み込み再生
- 📝 **歌詞表示**
  - **LRC（タイムタグ付き）**：再生位置に合わせて「現在行」をハイライト
  - **TXT（プレーンテキスト）**：文章として表示（同期なし）
- 🇯🇵 **日本語訳（任意）**
  - `JP: ON` で、英文の直下に日本語訳を表示
  - 翻訳はオンライン（MyMemory）を利用するため **ネット接続が必要** です  
    ※環境によって CORS / 回数制限等で失敗することがあります（その場合は「Google翻訳へ」の導線が出ます）
- 📚 **TANGO-CHO連動**
  - 歌詞中の英単語をタップ → 単語（＋例文）を **コピー/共有** して TANGO-CHO に渡します
  - iPhone（Safari / ホーム画面PWA）は基本 **コピー → TANGO-CHOで貼り付け** が確実です

---

## まず準備するもの（初心者向け）

LyricsPocket 自体は「Webページ」なので、**アプリ用のファイル**と、使うときに読み込む **音源／歌詞ファイル**の2種類を用意します。

### 1) 音源ファイル（AUDIO）

- 例：`Artist - Title.m4a` / `Artist - Title.mp3`
- **DRM（保護）付きの楽曲**（例：ストリーミングのダウンロード楽曲）は、ブラウザから選べない／再生できない場合があります  
  → 自分で用意した通常の音声ファイルを使ってください。

#### 置き場所のおすすめ
- **iPhone / iPad**：`ファイル`アプリ内にフォルダを作るのが確実  
  例）`ファイル > このiPhone内 > LyricsPocket > audio`
- **Android**：`Download` など分かりやすい場所に  
  例）`Download/LyricsPocket/audio`
- **PC**：任意（後で選べればOK）

### 2) 歌詞ファイル（LYRICS）

- `.lrc`（タイムタグ付き）または `.txt`（プレーンテキスト）を使えます。
- 例：`Artist - Title.lrc` / `Artist - Title.txt`

#### LRC（同期できる歌詞）の書式
基本はこの形です：

```lrc
[00:12.34] Midnight rovers
[00:15.80] City slickers
[00:19.10] Gunmen and maniacs
```

- `[分:秒.ミリ秒]` の形式（`[01:23.45]` など）
- 1行に複数のタイムタグがあってもOK（一般的なLRC仕様に対応）

#### TXT（同期なし歌詞）
タイムタグが無い普通のテキストでも表示できます（同期ハイライトはしません）。

### 3) ファイル名（曲と歌詞の“自動一致”のコツ）

LyricsPocket は、**音源ファイル名と歌詞ファイル名**を見て自動で対応付けようとします。  
うまく一致させるコツは：

- **曲名のベースを同じにする**
  - ✅ `Massive Attack - Safe From Harm.m4a`
  - ✅ `Massive Attack - Safe From Harm.lrc`
- 余計な装飾（リマスター表記など）が多い場合でも、ある程度は自動で吸収しますが、
  **最初はシンプルに揃える**のが確実です。

> もし自動で一致しない場合でも、画面下の `LYRICS` から手動で選べます。  
> 一度手動で選ぶと、その対応が端末に保存され、次回から自動で出やすくなります。

---

## 使い方 / How to use（ユーザー向け）

1. 画面上部の **`AUDIOを選ぶ`** を押して、音源ファイルを選択  
   - 複数選択できます（PCは Shift / Ctrl など。スマホは機種により挙動が異なります）
2. **`LYRICSを選ぶ`** を押して、`.lrc` または `.txt` を選択（複数OK）
3. `PLAY` で再生
4. LRCの場合：再生位置に合わせて現在行がハイライトされます  
   - ※再生に合わせて **画面が勝手にスクロールはしません**
5. `JP: ON` で日本語訳を表示（ネット接続が必要）
6. 英単語（WORDS）をタップして **TANGO-CHO** へ送る  
   - その単語＋今の歌詞行（例文）を渡します


### iPhoneで単語をTANGO-CHOへ渡す方法（コピー → 貼り付け）

iPhone（Safari / ホーム画面PWA）では、LyricsPocketは **勝手にTANGO-CHOを開かず**、まず **クリップボードにコピー**します（ストレージが分かれて“空のTANGO-CHO”が開く事故を避けるため）。

1. LyricsPocketで、下の **WORDS** チップ、または歌詞中の **英単語** をタップ
2. 画面下に `COPIED（TANGO-CHOで貼り付け）` などが出たらコピー完了
   - 端末によっては **共有シート** が出ます。その場合はキャンセルしてOKです（コピーは行われています）
3. TANGO-CHO を開く（SafariでもPWAでもOK）
4. TANGO-CHO側の **「貼り付け」** ボタン、または入力欄を長押し→貼り付け
5. 取り込み→保存

うまく貼り付けできないときは、同じ単語をもう一度タップしてコピーし直してから貼り付けると安定します。

### 曲と歌詞が一致しないとき（手動で合わせる）
- まず `TRACKS` から曲を選ぶ
- 次に `LYRICS` 一覧から該当の歌詞を選ぶ

---

## このリポジトリに入っているファイル（開発・設置向け）

> 基本的に **同じフォルダ（リポジトリ直下）** に以下を置けばOKです。

- `index.html` … アプリ本体（UI/ロジックが入っています）
- `manifest.webmanifest` … PWA用の設定
- `sw.js` … **自爆するSW（復旧用）**  
  ※通常運用で Service Worker を登録しない設計です
- `kill-sw.html` … キャッシュ／Service Worker を掃除してから `index.html` に戻すページ
- `rescue.html` … 白画面・反映不良などの緊急用リセットページ
- `screenshot1.png` … README用スクショ（任意）
- `README.md` … この説明

---

## ローカルで動かす方法（初心者向け）

### 1) いちばん簡単：ローカルサーバーを立てる（推奨）
ブラウザの制約（特に翻訳APIや一部機能）を避けるため、`file://` 直開きより **HTTPで開く**のが安全です。

#### A. Python がある場合（Windows/Mac）
プロジェクトのフォルダでターミナルを開いて：

```bash
python -m http.server 8000
```

次にブラウザで `http://localhost:8000/` を開きます。

#### B. VS Code の Live Server を使う
- VS Code 拡張「Live Server」を入れる
- `index.html` を右クリック → `Open with Live Server`

### 2) 動作確認のポイント
- 音源ファイルを選べるか（AUDIO）
- 歌詞ファイルを選べるか（LYRICS）
- `JP: ON` で翻訳が表示されるか（ネット環境に依存）

---

## GitHub Pages に公開する方法（初心者向け）

1. GitHubで新規リポジトリを作る（例：`LyricsPocket`）
2. このプロジェクトのファイル一式を **リポジトリ直下**にアップロードしてコミット
3. GitHubの `Settings` → `Pages`
4. `Build and deployment` で
   - `Source: Deploy from a branch`
   - `Branch: main`（または master） / `/(root)` を選択
5. 表示されたURL（`https://<user>.github.io/<repo>/`）にアクセス

---

## 反映されない・白画面になるとき（キャッシュ対策）

GitHub Pages や iPhone のPWAは、更新が反映されず「古い版」が残ることがあります。

1. まず **シークレット/プライベート**で開いて確認
2. それでもダメなら、次を開いてください：
   - `kill-sw.html`（軽いリセット）
   - `rescue.html`（強めのリセット）

---

## 著作権・取り扱い（重要）

- 本アプリは **音源や歌詞を配布しません**。  
  利用者が所有／許諾を得たファイルを読み込む前提です。
- 歌詞の取り扱いは、各地域の法令・利用規約・権利者の条件に従ってください。

---

## 免責
本アプリの利用により生じたいかなる損害についても、作者は責任を負いません。
